<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ã†ã¡ã‚…ã†ã²ã‚‰ãŒãªã‹ã‚‹ãŸ</title>

<style>
body{
  margin:0;
  font-family:sans-serif;
  background:radial-gradient(circle at top,#3b1d6b 0%,#1b0f3a 40%,#09001a 100%);
  color:white;
}
.container{display:flex;padding:20px}

/* æƒ‘æ˜Ÿï¼ˆCPUï¼‰ */
.cpu-area{
  width:220px;
  text-align:center;
  margin-right:20px;
}
.cpu-area img{width:140px}
.cpu-talk{
  margin-top:10px;
  font-size:16px;
  background:rgba(255,255,255,.15);
  border-radius:12px;
  padding:10px;
  line-height:1.4;
}

/* ğŸŒŸ ã¦ã‚“ã•ã„ã‚«ãƒ¼ãƒ‰ */
.tensai-card{
  margin-top:12px;
}
.tensai-card img{
  width:120px;
  border-radius:16px;
  box-shadow:0 0 20px gold;
}

/* ãƒ¡ã‚¤ãƒ³ */
.main{flex:1;text-align:center}
h1{margin:0}
.howto{font-size:16px;margin:6px 0 12px}
.score{font-size:20px;margin-bottom:10px}
#question{font-size:24px;margin:10px 0}

/* ã‚«ãƒ¼ãƒ‰ */
.cards{
  display:grid;
  grid-template-columns:repeat(6,1fr);
  gap:20px;
  justify-items:center;
  margin-top:20px;
}
.card{
  width:140px;height:180px;
  background:white;
  border-radius:20px;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  box-shadow:0 6px 12px rgba(0,0,0,.4);
}
.card img{
  max-width:100%;
  max-height:100%;
  border-radius:12px
}

/* ğŸŒˆ ãƒœãƒ¼ãƒŠã‚¹ã‚«ãƒ¼ãƒ‰ï¼ˆ2ç‚¹ï¼‰ */
.card.bonus{
  background:#fff1f1;
  border:4px solid #ff5252;
  box-shadow:0 0 20px #ff5252;
}

/* ãƒœã‚¿ãƒ³ */
.buttons{margin-top:20px}
button{
  font-size:20px;
  padding:10px 24px;
  border-radius:20px;
  border:none;
  cursor:pointer;
}
.start-btn{background:#aed581}
.next-btn{background:#ffcc80}
.retry-btn{background:#90caf9}
</style>
</head>

<body>
<div class="container">

  <!-- æƒ‘æ˜Ÿï¼ˆCPUï¼‰ -->
  <div class="cpu-area">
    <img id="cpuImg">
    <div class="cpu-talk" id="cpuTalk"></div>
  </div>

  <!-- ãƒ¡ã‚¤ãƒ³ -->
  <div class="main">
    <h1>ã†ã¡ã‚…ã†ã²ã‚‰ãŒãªã‹ã‚‹ãŸ</h1>
    <div class="howto" id="howto"></div>
    <div class="score" id="score"></div>
    <div id="question"></div>
    <div class="cards" id="cards"></div>
    <div class="buttons" id="buttons"></div>
  </div>

</div>

<script>
// =======================
// ã‚«ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ï¼ˆã‚ã€œã‚’ï¼‰
const data = [
  {c:"ã‚",q:"ã‚ã¾ã®ãŒã‚",img:"image/amanoj.png"},
  {c:"ã„",q:"ã„ã‚“ã›ã",img:"image/inseki.png"},
  {c:"ã†",q:"ã†ã¡ã‚…ã†",img:"image/uchuu.png"},
  {c:"ãˆ",q:"ãˆã„ã›ã„",img:"image/eisei.png"},
  {c:"ãŠ",q:"ãŠã‚ŠãŠã‚“ã–",img:"image/orion.png"},
  {c:"ã‹",q:"ã‹ã›ã„",img:"image/kasei.png"},
  {c:"ã",q:"ãã‚“ã›ã„",img:"image/kinsei.png"},
  {c:"ã",q:"ãã‚‹ãã‚‹ ãã‚“ãŒ",img:"image/kurukuru.png"},
  {c:"ã‘",q:"ã‘ã‚Œã™",img:"image/ceres.png"},
  {c:"ã“",q:"ã“ã¨ã–",img:"image/koto.png"},
  {c:"ã•",q:"ã•ãŸãƒ¼ã‚“",img:"image/saturn.png"},
  {c:"ã—",q:"ã—ã‚Šã†ã™",img:"image/sirius.png"},
  {c:"ã™",q:"ã™ã„ã›ã„",img:"image/suisei.png"},
  {c:"ã›",q:"ã›ã„ã–",img:"image/seiza.png"},
  {c:"ã",q:"ãã‚‰ã® ã»ã—",img:"image/sorano.png"},
  {c:"ãŸ",q:"ãŸã„ã‚ˆã†",img:"image/taiyou.png"},
  {c:"ã¡",q:"ã¡ãã‚…ã†",img:"image/chikyuu.png"},
  {c:"ã¤",q:"ã¤ã",img:"image/tsuki.png"},
  {c:"ã¦",q:"ã¦ã‚“ã®ã†ã›ã„",img:"image/tennou.png"},
  {c:"ã¨",q:"ã¨ãŠã„ã»ã—",img:"image/toihoshi.png"},
  {c:"ãª",q:"ãªãŒã‚Œã¼ã—",img:"image/nagare.png"},
  {c:"ã«",q:"ã«ã˜ã„ã‚ ã†ã¡ã‚…ã†",img:"image/nijiiro.png"},
  {c:"ã¬",q:"ã¬ã„ãã‚‹ã¿ ã›ã„ã˜ã‚“",img:"image/nuigurumi.png"},
  {c:"ã­",q:"ã­ã·ã¡ã‚…ãƒ¼ã‚“",img:"image/neputun.png"},
  {c:"ã®",q:"ã®ãƒ¼ã™ ã™ãŸãƒ¼",img:"image/northstar.png"},
  {c:"ã¯",q:"ã¯ã†ã‚ã‚",img:"image/haumea.png"},
  {c:"ã²",q:"ã²ã‹ã‚‹ ã»ã—",img:"image/hikaru.png"},
  {c:"ãµ",q:"ãµã‚ãµã‚ ã†ã¡ã‚…ã†",img:"image/fuwa.png"},
  {c:"ã¸",q:"ã¸ã‚“ã—ã‚“ ã‚ã‘ã£ã¨",img:"image/henshin.png"},
  {c:"ã»",q:"ã»ãã¨ã—ã¡ã›ã„",img:"image/hokuto.png"},
  {c:"ã¾",q:"ã¾ã‘ã¾ã‘",img:"image/makemake.png"},
  {c:"ã¿",q:"ã¿ã‹ã¥ã",img:"image/mikazuki.png"},
  {c:"ã‚€",q:"ã‚€ã’ã‚“ã® ã†ã¡ã‚…ã†",img:"image/mugen.png"},
  {c:"ã‚",q:"ã‚ã„ãŠã†ã›ã„",img:"image/meiou.png"},
  {c:"ã‚‚",q:"ã‚‚ãã›ã„",img:"image/mokusei.png"},
  {c:"ã‚„",q:"ã‚„ãã–",img:"image/yagi.png"},
  {c:"ã‚†",q:"ã‚†ãƒ¼ãµã‰ãƒ¼",img:"image/ufo.png"},
  {c:"ã‚ˆ",q:"ã‚ˆãã‚‰",img:"image/yozora.png"},
  {c:"ã‚‰",q:"ã‚‰ã›ã‚“ ãã‚“ãŒ",img:"image/rasen.png"},
  {c:"ã‚Š",q:"ã‚Šã‚…ã†ã›ã„ãã‚“",img:"image/ryuusei.png"},
  {c:"ã‚‹",q:"ã‚‹ã‚“ã‚‹ã‚“ã‚ã‘ã£ã¨",img:"image/runrun.png"},
  {c:"ã‚Œ",q:"ã‚Œã„ã‚“ã¼ãƒ¼ ã™ãŸãƒ¼",img:"image/rainbow.png"},
  {c:"ã‚",q:"ã‚ã‘ã£ã¨ ã¯ã£ã—ã‚ƒ",img:"image/rocketstart.png"},
  {c:"ã‚",q:"ã‚ãã›ã„ ã—ã‚…ã†ã”ã†",img:"image/wakusei.png"},
  {c:"ã‚’",q:"ãŸã„ã‚ˆã†ã‘ã„ã‚’ ãŸã³ã™ã‚‹",img:"image/tabi.png"}
];

// =======================
// ã‚¹ãƒ†ãƒ¼ã‚¸å®šç¾©ï¼ˆver1.2.3ï¼‰
const stages = [
  {name:"ã™ã„ã›ã„", time:6000, rounds:3, cpuImg:"image/suisei.png", bonus:false},
  {name:"ãã‚“ã›ã„", time:5000, rounds:4, cpuImg:"image/kinsei.png", bonus:true},
  {name:"ã¡ãã‚…ã†", time:5000, rounds:5, cpuImg:"image/chikyuu.png", bonus:false},
  {name:"ã‹ã›ã„",  time:4000, rounds:6, cpuImg:"image/kasei.png",  bonus:true},
  {name:"ã‚‚ãã›ã„",time:3500, rounds:7, cpuImg:"image/mokusei.png", bonus:true},
  {name:"ã©ã›ã„",  time:3200, rounds:7, cpuImg:"image/saturn.png", bonus:true},
  {name:"ã¦ã‚“ã®ã†ã›ã„",time:2900, rounds:8, cpuImg:"image/tennou.png", bonus:true},
  {name:"ã‹ã„ãŠã†ã›ã„",time:2800, rounds:9, cpuImg:"image/neputun.png", bonus:false},
  {name:"ãŸã„ã‚ˆã†",time:2700, rounds:9, cpuImg:"image/taiyou.png", bonus:true}
];

let stageIndex=0;
let currentRound=0;
let playerPoint=0;
let cpuPoint=0;
let readQueue=[];
let bonusChars=[];

// -----------------------
function speak(t){
  speechSynthesis.cancel();
  const u=new SpeechSynthesisUtterance(t);
  u.lang="ja-JP";
  speechSynthesis.speak(u);
}

function showStart(){
  playerPoint=0;
  cpuPoint=0;
  document.getElementById("cpuImg").src="";
  document.getElementById("cpuTalk").textContent="";
  document.getElementById("score").textContent="";
  document.getElementById("question").textContent="";
  document.getElementById("cards").innerHTML="";
  document.getElementById("howto").textContent=
    "ã‚ãã³ã‹ãŸï¼šã‚ˆã¾ã‚ŒãŸ ã‹ãƒ¼ã©ã‚’ ãˆã‚‰ã‚“ã§ã­ã€‚";
  document.getElementById("buttons").innerHTML=
    `<button class="start-btn">â–¶ ã¯ã˜ã‚ã‚‹</button>`;
  document.querySelector(".start-btn").onclick=()=>{
    stageIndex=0;
    startStage();
  };
}

function startStage(){
  const stage=stages[stageIndex];
  playerPoint=0;
  cpuPoint=0;
  currentRound=0;

  document.getElementById("cpuImg").src=stage.cpuImg;

  const shuffled=[...data].sort(()=>Math.random()-.5);
  const field=shuffled.slice(0,stage.rounds*2);

  bonusChars=[];
  if(stage.bonus){
    const count =
      stage.name==="ãŸã„ã‚ˆã†" ? 2 :
      stage.name==="ã‹ã›ã„"  ? 1 :
      stage.name==="ã©ã›ã„"  ? 2 : 1;

    bonusChars = field
      .sort(()=>Math.random()-.5)
      .slice(0,count)
      .map(c=>c.c);
  }

  const cardsArea=document.getElementById("cards");
  cardsArea.innerHTML="";
  field.forEach(c=>{
    const d=document.createElement("div");
    d.className="card";
    d.dataset.char=c.c;
    if(bonusChars.includes(c.c)){
      d.classList.add("bonus");
      d.dataset.bonus="true";
    }
    d.innerHTML=`<img src="${c.img}">`;
    cardsArea.appendChild(d);
  });

  readQueue = field
    .slice(0,stage.rounds)
    .sort(()=>Math.random()-.5);

  updateScore();
  updatePlanetTalk();
  document.getElementById("buttons").innerHTML="";
  nextTurn();
}

function updateScore(){
  document.getElementById("score").textContent=
    `ğŸ˜Š ã‚ãªãŸï¼š${playerPoint}ã€€ğŸŒ‘ ${stages[stageIndex].name}ï¼š${cpuPoint}`;
}

function updatePlanetTalk(){
  const stage=stages[stageIndex];
  const remain=stage.rounds-currentRound;
  let text="";
  if(remain>1) text=`ã‚ã¨ ${remain}ã¾ã„ ã ã‚ˆï¼`;
  else if(remain===1) text="ã•ã„ã”ã® 1ã¾ã„ ã ã‚ˆï¼";
  else text="ãœã‚“ã¶ ã¨ã‚ŒãŸã­ï¼";

  if(stage.bonus){
    text+="<br><small>ã„ã‚ã®ã¡ãŒã† ã‹ãƒ¼ã©ã‚’<br>ã¨ã‚‹ã¨ ã„ã„ã“ã¨ãŒ ã‚ã‚‹ã‚ˆ</small>";
  }
  document.getElementById("cpuTalk").innerHTML=`${stage.name}<br>${text}`;
}

function nextTurn(){
  if(readQueue.length===0){
    finishStage();
    return;
  }

  const targetChar=readQueue.shift().c;
  const target=document.querySelector(`.card[data-char="${targetChar}"]`);
  const info=data.find(d=>d.c===targetChar);

  document.getElementById("question").textContent=
    `${info.q} ã®ã€Œ${info.c}ã€ã¯ ã©ã‚Œã‹ãªï¼Ÿ`;
  speak(`${info.q} ã® ${info.c}`);

  let decided=false;
  setTimeout(()=>{
    if(!decided){
      const p=target.dataset.bonus==="true"?2:1;
      cpuPoint+=p;
      currentRound++;
      updateScore();
      updatePlanetTalk();
      nextTurn();
    }
  },stages[stageIndex].time);

  document.querySelectorAll(".card").forEach(card=>{
    card.onclick=()=>{
      if(decided) return;
      decided=true;
      speechSynthesis.cancel();
      const p=card.dataset.bonus==="true"?2:1;
      if(card===target) playerPoint+=p;
      else cpuPoint+=p;
      currentRound++;
      updateScore();
      updatePlanetTalk();
      nextTurn();
    };
  });
}

function finishStage(){
  const buttons=document.getElementById("buttons");
  buttons.innerHTML="";
  document.getElementById("cpuTalk").innerHTML+="<br><br>ã¾ãŸ ã‚ãã¼ã†ï¼";

  if(playerPoint>cpuPoint){

    if(stages[stageIndex].name==="ãŸã„ã‚ˆã†"){
      speak("ãã¿ãŒ ã‚†ã†ã—ã‚‡ã†ã ã‚ˆ");
      document.getElementById("cpuTalk").innerHTML+=`
        <br><strong>ãã¿ãŒ ã‚†ã†ã—ã‚‡ã†ã ã‚ˆï¼</strong>
        <div class="tensai-card">
          <img src="image/tensai.png">
        </div>`;
    }else{
      speak("ã‚ãªãŸã® ã‹ã¡ï¼");
    }

    const b=document.createElement("button");
    b.className="next-btn";
    if(stageIndex<stages.length-1){
      b.textContent="ã¤ãã®ã»ã—ã¸";
      b.onclick=()=>{stageIndex++;startStage();};
    }else{
      b.textContent="ã‚‚ã†ã„ã¡ã©";
      b.onclick=showStart;
    }
    buttons.appendChild(b);

  }else{
    speak("ã‚ãªãŸã® ã¾ã‘");
    const b=document.createElement("button");
    b.className="retry-btn";
    b.textContent="ã¯ã˜ã‚ã«";
    b.onclick=showStart;
    buttons.appendChild(b);
  }
}

// åˆæœŸè¡¨ç¤º
showStart();
</script>
</body>
</html>
